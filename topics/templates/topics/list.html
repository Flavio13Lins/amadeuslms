{% load static i18n pagination permissions_tags %}
{% load django_bootstrap_breadcrumbs %}

{% subject_permissions request.user subject as has_subject_permissions %}

<div class="panel-group subject-group" id="topics-accordion" role="tablist" aria-multiselectable="true">
	<input type="hidden" class="url_order" value="{% url 'topics:update_order' %}" />
	<input type="hidden" class="subs_url" value="{% url 'subjects:view' subject.slug %}" />
	
	{% for topic in subject.topic_subject.all %}
		{% if not topic.repository and topic.visible or has_subject_permissions %}
			<div class="panel panel-info {% if not topic.visible or topic.repository %} topic-panel-invisible {% else %} topic-panel {% endif %}">
		        <div class="panel-heading">
		            <div class="row">
		                <div class="col-md-12 category-header">
		                    <h4 class="panel-title">
		                        <a class="category-course-link pull-left" data-parent="#topics-accordion" data-toggle="collapse" href="#{{topic.slug}}">
		                            <button class="btn btn-default btn-xs text-center cat-selector"><i class="fa fa-angle-right fa-2x" aria-hidden="true"></i></button> {{ topic }}
		                        </a>
		                    </h4>

	                        {% if has_subject_permissions %}
		                    	<div class="col-md-5 pull-right category-card-items">
		                            <a href="" id="moreActions" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> 
		                                <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
		                            </a>
		                            <ul class="dropdown-menu pull-right" aria-labelledby="moreActions">
		                                <li><a href="{% url 'topics:update' subject.slug topic.slug %}"><i class="fa fa-pencil fa-fw" aria-hidden="true"></i>{% trans 'Edit' %}</a></li>
		                                <li><a href="javascript:delete_topic('{% url 'topics:delete' topic.slug %}')"><i class="fa fa-trash fa-fw" aria-hidden="true"></i>&nbsp;{% trans 'Remove' %}</a></li>
		                            </ul>
		                            <a href="" ><i class="fa fa-arrows move_topic" aria-hidden="true"></i></a>
		                    	</div>
	                        {% endif %}
		                </div>
		            </div>
		        </div>
			    <div id="{{topic.slug}}" class="panel-collapse collapse category-panel-content">
			    	<input type="hidden" class="id_inp" name="id" value="{{ topic.id }}" />
			    	<input type="hidden" class="order_inp" name="order" value="{{ topic.order }}" />
			    	
	    			{% autoescape off %}
						{{ topic.description }}
					{% endautoescape %}

					{% if has_subject_permissions %}
						<div class="row text-center">
							<div class="btn-group add_resource">
						  		<button type="button" class="btn btn-success btn-raised dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						  			<i class="fa fa-angle-right"></i> {% trans 'Add Resource' %}
							  	</button>
							  	<ul class="dropdown-menu">
							    	<li><a href="#"><i class="fa fa-video-camera"></i> {% trans 'Video Embed' %}</a></li>
							    	<li><a href="#"><i class="fa fa-comments-o"></i> {% trans 'Forum' %}</a></li>
							    	<li><a href="#"><i class="fa fa-file-archive-o"></i> {% trans 'File Link' %}</a></li>
							    	<li><a href="{% url 'webpages:create' topic.slug %}"><i class="fa fa-file-o"></i> {% trans 'Webpage' %}</a></li>
							    	<li><a href="#"><i class="fa fa-question-circle-o"></i> {% trans 'Questionary' %}</a></li>
							  	</ul>
							</div>
						</div>
					{% endif %}

					{% include 'resources/list.html' with topic=topic %}
			    </div>
		    </div>
		{% endif %}
	{% endfor %}
</div>

<script type="text/javascript" src="{% static 'js/topics.js' %}"></script>