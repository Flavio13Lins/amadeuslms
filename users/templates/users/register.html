{% extends 'base.html' %}

{% load static i18n %}
{% load widget_tweaks %}

{% block nav %}
{% endblock %}

{% block breadcrumbs %}
{% endblock %}

{% block sidebar %}
{% endblock sidebar %}

{% block javascript %}
<script>
	$(function () {

		/* SCRIPT TO OPEN THE MODAL WITH THE PREVIEW */
		$("#id_image").change(function () {
			if (this.files && this.files[0]) {
				var reader = new FileReader();
				reader.onload = function (e) {
					$("#image").attr("src", e.target.result);
					$("#modalCrop").modal("show");
				}
				reader.readAsDataURL(this.files[0]);
			}
		});

		/* SCRIPTS TO HANDLE THE CROPPER BOX */
		var $image = $("#image");
		var cropBoxData;
		var canvasData;
		$("#modalCrop").on("shown.bs.modal", function () {
			$image.cropper({
				viewMode: 1,
				aspectRatio: 1/1,
				minCropBoxWidth: 200,
				minCropBoxHeight: 200,
				ready: function () {
					$image.cropper("setCanvasData", canvasData);
					$image.cropper("setCropBoxData", cropBoxData);
				}
			});
		}).on("hidden.bs.modal", function () {
			cropBoxData = $image.cropper("getCropBoxData");
			canvasData = $image.cropper("getCanvasData");
			$image.cropper("destroy");
		});

		$(".js-zoom-in").click(function () {
			$image.cropper("zoom", 0.1);
		});

		$(".js-zoom-out").click(function () {
			$image.cropper("zoom", -0.1);
		});

		/* SCRIPT TO COLLECT THE DATA AND POST TO THE SERVER */
		$(".js-crop-and-upload").click(function () {
			var cropData = $image.cropper("getData");
			$("#id_x").val(cropData["x"]);
			$("#id_y").val(cropData["y"]);
			$("#id_height").val(cropData["height"]);
			$("#id_width").val(cropData["width"]);
			$("#modalCrop").modal('hide');
		});

	});
</script>

{% endblock javascript %}




{% block content %}
	<div class="row">
		<div class="col-lg-offset-1 col-md-offset-1">
            <img src="{{ theme.large_logo_url }}" class="img-responsive center-block logo-login logo-register" alt="logo amadeus">
        </div>
	</div>

	<div class="row">
		<div class="col-lg-offset-2 col-md-offset-2 col-sm-offset-1 col-lg-9 col-md-9 col-sm-10">
			{% if messages %}
				{% for message in messages %}
					<div class="alert alert-{{ message.tags }} alert-dismissible" role="alert">
						<button type="button" class="close" data-dismiss="alert" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<p>{{ message }}</p>
					</div>
				{% endfor %}
			{% endif %}

			<div class="card">
				<div class="card-body">
					<div class="row">
						<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">
							<h2 class="outside-title"><strong>{% trans "User Register" %}</strong></h2>
						</div>
					</div>

					<form class="{% if form.has_error %} has-error {% endif %} form-horizontal is-fileinput" method="post" enctype="multipart/form-data" id="formUpload">
						{% csrf_token %}
						{% for field in form %}
							<div class="col-lg-12 col-md-12 col-sm-12">
								<div class="form-group form-group-md">
									<div class="col-md-12 col-sm-12 col-xs-12 col-lg-12">
										{% if field.auto_id == 'id_image' %}
											{% render_field field class='form-control' %}
											<div class="input-group">
							                    <input type="text" readonly="" class="form-control" placeholder="{% trans 'Choose your photo...' %}">
							                    <span class="input-group-btn">
							                        <button type="button" class="btn btn-fab btn-fab-mini">
							                          	<i class="material-icons">image</i>
							                        </button>
							                    </span>
							                </div>
							            {% else %}
							            	{% if field.auto_id == 'id_show_email' %}
							            		<label for="{{ field.auto_id }}" class="control-label">{{ field.label }}</label>
							            	{% endif %}

											{% render_field field class='form-control' %}
										{% endif %}
										<span class="help-block">{{ field.help_text }}</span>
										{% if field.errors %}
											<div class="row">
												<div class="alert alert-danger alert-dismissible" role="alert">
													<button type="button" class="close" data-dismiss="alert" aria-label="Close">
														<span aria-hidden="true">&times;</span>
													</button>
													<ul>
														{% for error in field.errors %}
														<li>{{ error }}</li>
														{% endfor %}
													</ul>
												</div>
											</div>
										{% endif %}
									</div>
								</div>
							</div>
						{% endfor %}
						<div class="row">
							<div class="col-lg-12 col-md-12 col-sm-12">
								<div class="col-md-6 col-xs-6 col-sm-6 col-lg-6 text-center">
									<input type="submit" value="{% trans 'Register' %}" class="btn btn-success btn-raised btn-block" />
								</div>
								<div class="col-md-6 col-xs-6 col-sm-6 col-lg-6 text-center">
									<a href="{% url 'users:login' %}" class="btn btn-default btn-raised btn-block"> {% trans 'Back' %}</a>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<!-- MODAL TO CROP THE IMAGE -->
	<div class="modal fade" id="modalCrop" data-keyboard="false" data-backdrop="static">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	        <h4 class="modal-title">Crop the photo</h4>
	      </div>
	      <div class="modal-body">
	        <img src="" id="image" style="max-width: 100%;">
	      </div>
	      <div class="modal-footer">
	        <div class="btn-group pull-left" role="group">
	          <button type="button" class="btn btn-default js-zoom-in">
	            <span class="glyphicon glyphicon-zoom-in"></span>
	          </button>
	          <button type="button" class="btn btn-default js-zoom-out">
	            <span class="glyphicon glyphicon-zoom-out"></span>
	          </button>
	        </div>
	        <button type="button" class="btn btn-raised btn-default" data-dismiss="modal">{% trans 'Cancel' %}</button>
	        <button type="button" class="btn btn-success btn-raised post-button js-crop-and-upload">{% trans 'Crop' %} </button>
	      </div>
	    </div>
	  </div>
	</div>
{% endblock %}

{% block bottommenu %}
{% endblock %}
