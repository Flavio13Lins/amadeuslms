{% load widget_tweaks i18n %}

<!--MODAL CREATE LINK-->
<div class="modal fade" id="createLinksModal" tabindex="-1" role="dialog" aria-labelledby="createLink">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
        <h4 class="modal-title" id="createLink">{% trans 'Create a New Link' %}</h4>
      </div>
      <div class="modal-body">
        <!-- Card -->
        <form method="post" action="" id="form-link" enctype="multipart/form-data">
          {% csrf_token %}
          {% if messages %}
              {% for message in messages %}
                  <div class="alert alert-{{ message.tags }} alert-dismissible" role="alert">
                      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                      </button>
                      <p>{{ message }}</p>
                  </div>
              {% endfor %}
          {% endif %}
        {% for field in form %}
            {% if field.field.required %}
              <label for="{{ field.auto_id }}">{{ field.label }}<span>*</span></label>
            {% else %}
              <label for="{{ field.auto_id }}">{{ field.label }}</label>
            {% endif %}
            {% render_field field class='form-control' %}
        {% endfor %}
        <div class="form-group">
          <a href="javascript:void(0)" class="btn btn-raised btn-default" data-dismiss="modal">{% trans 'Cancel' %}</a>
          <button class="btn btn-raised btn-primary" type="submit">{% trans 'Submit' %]</button>
        </div>
        <!-- .end Card -->
      </div>
    </div>
  </div>
</div>
<!-- EndModal -->

{# // <script src="{% static '/links.js' %}"></script> #}
<script type="text/javascript">
  $("#form-link").submit(function(event) {
        var data = new FormData($('#form-link').get(0));
        $.ajax({
            url: "{% url 'course:links:create_link' topic.slug %}",
            type: $("#form-link").attr('method'),
            data: data,
            cache: false,
            processData: false,
            contentType: false,
            success: function(data) {
                $('#createLinksModal').modal('hide');
                $('#list-topic{{ topic.id }}-links').append(data);
                $('#list-topic{{ topic.id }}-links-edit').append(data);
            },
            error: function(data){
                $('.erro').html(data.responseText);
                $('.modal-backdrop').remove();
                $('#createLinksModal').modal();
            }
        });
        event.preventDefault();
      });
</script>
